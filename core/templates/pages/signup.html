<!DOCTYPE html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <title>Register â€“ Koki's Foodhub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{--brand:#D84315;--accent:#FFD23F}
    html,body{height:100%;margin:0}
    body{
      background:var(--accent);
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;align-items:center;justify-content:center;padding:24px
    }
    .auth-wrap{width:100%;max-width:420px}
    .brand-area{display:flex;flex-direction:column;align-items:center;gap:10px;margin-bottom:12px}
    .brand-area img{width:300px;max-width:88%;height:auto;display:block}
    h1.auth-title{font-size:46px;margin:8px 0 18px 0;text-align:center;font-weight:900;color:#111}
    form.auth-form{display:flex;flex-direction:column;gap:16px;padding:0}
    .auth-input{background:rgba(255,255,255,1);border:none;padding:20px 22px;border-radius:14px;font-size:16px;box-shadow:0 8px 18px rgba(0,0,0,0.08);width:100%;outline:none}
    .auth-input::placeholder{color:#9b9b9b}
    .auth-cta{background:var(--brand);color:#fff;border:none;padding:18px 20px;border-radius:14px;font-weight:900;font-size:18px;cursor:pointer;text-transform:uppercase}
    .auth-footer{margin-top:12px;text-align:center;color:#111}
    .auth-footer a{color:var(--brand);font-weight:700;text-decoration:none}
    @media(max-width:420px){.brand-area img{max-width:220px}}
  </style>
</head>
<body>
  <div class="auth-wrap">
    <div class="brand-area">
      <img src="{% static 'images/kuya-koki-logo.svg' %}" alt="Kuya Koki's">
    </div>

    <h1 class="auth-title">REGISTER</h1>

    <form method="post" class="auth-form">
      {% csrf_token %}

      <!-- Role selector: split buttons (Cashier default). Cashier registrations require Owner approval. -->
      <input type="hidden" name="role" id="roleInput" value="Cashier">
      <style>
        .role-toggle { display:flex; gap:12px; justify-content:center; align-items:center; margin-bottom:12px; }
        .role-btn { padding:8px 18px; border-radius:12px; border:none; font-weight:800; cursor:pointer; }
        .role-selected { background:#fff; color:#111; box-shadow:0 8px 18px rgba(0,0,0,0.06); }
        .role-unselected { background:transparent; color:#fff; opacity:0.9; box-shadow:none; }
      </style>
      <div class="role-toggle">
        <button type="button" id="roleCashier" class="role-btn role-selected">Cashier</button>
        <button type="button" id="roleOwner" class="role-btn role-unselected">Owner</button>
      </div>

      {% if messages %}
        {% for message in messages %}
          <div class="server-message" style="display:none;" data-text="{{ message }}"></div>
        {% endfor %}
      {% endif %}

      <input type="text" name="username" placeholder="Full Name" required class="auth-input" value="{{ request.POST.username|default:'' }}">
      <input type="email" name="email" placeholder="Email" required class="auth-input" value="{{ request.POST.email|default:'' }}">
      <input type="password" name="password" placeholder="Password" required class="auth-input">
      <input type="password" name="password_confirm" placeholder="Confirm Password" required class="auth-input">

      <button type="submit" class="auth-cta">SUBMIT</button>

      <p class="auth-footer">Already have an account? <a href="{% url 'login' %}">Login</a></p>
    </form>
  </div>
</body>

<!-- Toast UI + client-side validation -->
<style>
  .kf-toast{position:fixed;right:20px;top:20px;min-width:200px;max-width:320px;padding:12px 16px;border-radius:10px;background:rgba(0,0,0,0.85);color:#fff;font-weight:600;box-shadow:0 8px 20px rgba(0,0,0,0.25);z-index:9999;opacity:0;transform:translateY(-8px);transition:opacity .25s,transform .25s}
  .kf-toast.show{opacity:1;transform:translateY(0)}
  .kf-toast.error{background:#b71c1c}
</style>
<div id="kf-toast" class="kf-toast" aria-live="polite" role="status" style="display:none"></div>
<script>
  (function(){
    // Role selector behaviour (toggle CSS classes for clear selection)
    function setRoleButtons(){
      var roleInput = document.getElementById('roleInput');
      var cashierBtn = document.getElementById('roleCashier');
      var ownerBtn = document.getElementById('roleOwner');
      if(!roleInput || !cashierBtn || !ownerBtn) return;
      function select(btn){
        if(btn === cashierBtn){
          cashierBtn.classList.add('role-selected');
          cashierBtn.classList.remove('role-unselected');
          ownerBtn.classList.add('role-unselected');
          ownerBtn.classList.remove('role-selected');
          roleInput.value = 'Cashier';
        } else {
          ownerBtn.classList.add('role-selected');
          ownerBtn.classList.remove('role-unselected');
          cashierBtn.classList.add('role-unselected');
          cashierBtn.classList.remove('role-selected');
          roleInput.value = 'Owner';
        }
      }
      cashierBtn.addEventListener('click', function(){ select(cashierBtn); });
      ownerBtn.addEventListener('click', function(){ select(ownerBtn); });
      // initialize from current hidden input value
      if(roleInput.value === 'Owner') select(ownerBtn); else select(cashierBtn);
    }
    function showToast(text, isError){
      var t = document.getElementById('kf-toast');
      t.textContent = text;
      t.className = 'kf-toast' + (isError? ' error':'');
      t.style.display = 'block';
      // force reflow
      void t.offsetWidth;
      t.classList.add('show');
      clearTimeout(t._hideTimer);
      t._hideTimer = setTimeout(function(){ t.classList.remove('show'); setTimeout(function(){ t.style.display='none' },250); }, 4000);
    }

    document.addEventListener('DOMContentLoaded', function(){
      setRoleButtons();
      var form = document.querySelector('form.auth-form');
      if(!form) return;
      var pwd = form.querySelector('input[name="password"]');
      var pwd2 = form.querySelector('input[name="password_confirm"]');

      form.addEventListener('submit', function(ev){
        if(pwd && pwd2){
          if(pwd.value !== pwd2.value){
            ev.preventDefault();
            showToast('Passwords do not match', true);
            pwd2.focus();
            return false;
          }
        }
        // show immediate feedback while the request is processing
        showToast('Creating account...', false);
      });

      // show server-side messages as toast if present
      var serverMsg = document.querySelector('.server-message');
      if(serverMsg && serverMsg.dataset && serverMsg.dataset.text){
        showToast(serverMsg.dataset.text, false);
      }
    });
  })();
</script>
</html>
