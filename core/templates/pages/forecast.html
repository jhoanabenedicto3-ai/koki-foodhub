{% extends "layouts/base.html" %}

{% block title %}Forecast - Koki's Foodhub{% endblock %}

{% block content %}
  <div class="forecast-wrapper container">
  {% block extra_head %}
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
  {% endblock %}
  <div class="page-header" style="display:flex; align-items:center; justify-content:space-between; gap:18px;">
    <div style="flex:1;">
      <h1 class="section-title">Sales Forecast</h1>
      <p class="muted">AI-powered predictions based on your historical sales data.</p>
    </div>
    <div class="page-controls" style="display:flex; gap:10px; align-items:center;">
      <button class="btn btn-ghost" id="btnFilter" title="Filter"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right:8px; vertical-align:middle;"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 6h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 12h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 18h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>Filter</button>

      <div id="filterPanel" style="display:none; position:absolute; right:40px; top:68px; background:#fff; border:1px solid var(--border); padding:12px; border-radius:8px; box-shadow:0 6px 18px rgba(16,24,40,0.06); z-index:40; width:320px;">
        <div style="display:flex; gap:8px; align-items:center;">
          <div style="flex:1;"><label style="font-weight:700; font-size:12px; color:var(--text-secondary);">Start</label><input id="filterStart" type="date" style="width:100%; padding:8px; border:1px solid var(--border); border-radius:6px; margin-top:6px;"/></div>
          <div style="flex:1;"><label style="font-weight:700; font-size:12px; color:var(--text-secondary);">End</label><input id="filterEnd" type="date" style="width:100%; padding:8px; border:1px solid var(--border); border-radius:6px; margin-top:6px;"/></div>
        </div>
        <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px;">
          <button id="clearFilter" class="btn btn-ghost">Clear</button>
          <button id="applyFilter" class="btn" style="background:#2563eb; color:#fff; border-color:transparent;">Apply</button>
        </div>
      </div>

      <button class="btn btn-ghost" id="btnExport" title="Export"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right:8px; vertical-align:middle;"><path d="M12 3v12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 7l4-4 4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 21H3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>Export</button>

      <div class="live-controls" style="display:flex; gap:8px; align-items:center;">
        <button id="btnLiveToggle" class="btn btn-ghost" title="Live updates" aria-pressed="false" style="display:flex; gap:8px; align-items:center;">
          <span id="liveIndicator" style="width:10px; height:10px; border-radius:999px; background:#d1d5db; display:inline-block; box-shadow:inset 0 0 0 2px rgba(0,0,0,0.02);"></span>
          <span style="font-weight:700; font-size:13px;">Live</span>
        </button>
        <select id="liveIntervalSelect" class="btn" style="min-width:90px; padding:6px 8px;">
          <option value="30">30s</option>
          <option value="60" selected>60s</option>
          <option value="300">5m</option>
        </select>
      </div>

      <button class="btn" id="refreshForecastBtn" style="background:#2563eb; color:#fff; border-color:transparent;">Refresh Data</button>
    </div>
  </div>

    <!-- Forecast hero cards (three-up layout matching mock) -->
    <div class="forecast-hero-grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;align-items:stretch;">

      <div class="forecast-hero-card" style="width:100%;">
        <div class="hero-pct"><span class="growth-badge {% if today_growth_positive %}growth-up{% else %}growth-down{% endif %}">{{ today_growth_pct_display }}</span></div>
        <div class="hero-header">
          <div class="hero-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="4" width="18" height="18" rx="3" stroke="#111" stroke-opacity="0.8" stroke-width="1.2" fill="none"/><path d="M8 2v4M16 2v4" stroke="#111" stroke-opacity="0.8" stroke-width="1.2" stroke-linecap="round"/><path d="M7 11h10" stroke="#111" stroke-opacity="0.8" stroke-width="1.2" stroke-linecap="round"/></svg></div>
          <div class="hero-meta">
            <div class="hero-title">Tomorrow's Sales</div>
            <div class="hero-date">{{ tomorrow_label }}</div>
          </div>
        </div>
        <div class="hero-amount">{{ today_forecast_revenue_display }}</div>
        <div class="hero-row-bottom">
          <div class="hero-sub">Confidence: <span class="conf-pill">¬±{{ today_confidence_margin_display }}</span> <span class="muted info" title="Confidence interval">‚ìò</span></div>
          <div class="hero-trend">‚ñ≤ {{ today_confidence_pct }}%</div>
        </div>
      </div>

      <div class="forecast-hero-card">
        <div class="hero-pct"><span class="growth-badge {% if week_growth_positive %}growth-up{% else %}growth-down{% endif %}">{{ week_growth_pct_display }}</span></div>
        <div class="hero-header">
          <div class="hero-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 17l6-8 4 5 8-10" stroke="#111" stroke-opacity="0.9" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></div>
          <div class="hero-meta">
            <div class="hero-title">Next Week</div>
            <div class="hero-date">{{ next_week_label }}</div>
          </div>
        </div>
        <div class="hero-amount">{{ week_forecast_revenue_display }}</div>
        <div class="hero-row-bottom">
          <div class="hero-sub">Confidence: <span class="conf-pill">¬±{{ week_confidence_margin_display }}</span> <span class="muted info" title="Confidence interval">‚ìò</span></div>
          <div class="hero-trend">‚ñ≤ {{ week_confidence_pct }}%</div>
        </div>
      </div>

      <div class="forecast-hero-card">
        <div class="hero-pct"><span class="growth-badge {% if month_growth_positive %}growth-up{% else %}growth-down{% endif %}">{{ month_growth_pct_display }}</span></div>
        <div class="hero-header">
          <div class="hero-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="7" width="4" height="10" rx="1" stroke="#111" stroke-width="1.2" fill="none"/><rect x="10" y="4" width="4" height="13" rx="1" stroke="#111" stroke-width="1.2" fill="none"/><rect x="17" y="10" width="4" height="7" rx="1" stroke="#111" stroke-width="1.2" fill="none"/></svg></div>
          <div class="hero-meta">
            <div class="hero-title">Next Month</div>
            <div class="hero-date">{{ next_month_label }}</div>
          </div>
        </div>
        <div class="hero-amount">{{ month_forecast_revenue_display }}</div>
        <div class="hero-row-bottom">
          <div class="hero-sub">Confidence: <span class="conf-pill">¬±{{ month_confidence_margin_display }}</span> <span class="muted info" title="Confidence interval">‚ìò</span></div>
          <div class="hero-trend">‚ñ≤ {{ month_confidence_pct }}%</div>
        </div>
      </div>

    </div>  

  <!-- Compact controls removed for simplified UI to match mock -->

  {% if error_message %}
    <div style="margin-bottom: 16px; padding: 12px 16px; background: #fff3f2; border: 1px solid #fcd5d5; color:#7f1d1d; border-radius:8px;">
      <strong>Note:</strong> {{ error_message }}
    </div>
  {% endif %}

  {% if data %}
    <!-- Sales Overview & Prediction Chart -->
    <!-- Sales Overview Cards -->
    <div class="overview-grid" style="display:flex; gap:16px; align-items:stretch; overflow-x:auto; padding-bottom:6px; flex-wrap:wrap; justify-content:center;">
      <div class="overview-card" style="flex:0 0 320px; min-width:260px; max-width:320px; display:flex; margin:8px;">
        <div style="display:flex; align-items:center; gap:12px; width:100%;">
          <div class="card-left">
            <div style="font-size:12px; color:var(--text-secondary); font-weight:700;">Daily Sales</div>
            <div style="margin-top:8px; font-size:20px; font-weight:800; color:#111;" id="overviewDailyTotal">{{ daily_summary.total|default:'‚Äî' }}</div>
            <div style="margin-top:6px; font-size:12px; color:var(--text-secondary);" id="overviewDailyPct">{% if daily_summary %}{{ daily_summary.pct_change }}% {{ daily_summary.arrow|default:'' }}{% else %}‚Äî{% endif %}</div>
          </div>
          <div class="card-right">
            <div class="badge badge-warning">Predicted</div>
            <div id="overviewDailyConf" style="font-size:12px; color:var(--text-secondary);">Confidence: {{ daily_confidence|floatformat:0 }}%</div>
            <div class="card-icon">üìä</div>
          </div>
        </div>
      </div>

      <div class="overview-card" style="flex:0 0 320px; min-width:260px; max-width:320px; display:flex; margin:8px;">
        <div style="display:flex; align-items:center; gap:12px; width:100%;">
          <div class="card-left">
            <div style="font-size:12px; color:var(--text-secondary); font-weight:700;">Weekly Sales</div>
            <div style="margin-top:8px; font-size:20px; font-weight:800; color:#111;" id="overviewWeeklyTotal">{{ weekly_summary.total|default:'‚Äî' }}</div>
            <div style="margin-top:6px; font-size:12px; color:var(--text-secondary);" id="overviewWeeklyPct">{% if weekly_summary %}{{ weekly_summary.pct_change }}% {{ weekly_summary.arrow|default:'' }}{% else %}‚Äî{% endif %}</div>
          </div>
          <div class="card-right">
            <div class="badge badge-danger">Predicted</div>
            <div id="overviewWeeklyConf" style="font-size:12px; color:var(--text-secondary);">Confidence: {{ weekly_confidence|floatformat:0 }}%</div>
            <div class="card-icon">‚úîÔ∏è</div>
          </div>
        </div>
      </div>

      <div class="overview-card" style="flex:0 0 320px; min-width:260px; max-width:320px; display:flex; margin:8px;">
        <div style="display:flex; align-items:center; gap:12px; width:100%;">
          <div class="card-left">
            <div style="font-size:12px; color:var(--text-secondary); font-weight:700;">Monthly Sales</div>
            <div style="margin-top:8px; font-size:20px; font-weight:800; color:#111;" id="overviewMonthlyTotal">{{ monthly_summary.total|default:'‚Äî' }}</div>
            <div style="margin-top:6px; font-size:12px; color:var(--text-secondary);" id="overviewMonthlyPct">{% if monthly_summary %}{{ monthly_summary.pct_change }}% {{ monthly_summary.arrow|default:'' }}{% else %}‚Äî{% endif %}</div>
          </div>
          <div class="card-right">
            <div class="badge badge-warning">Predicted</div>
            <div id="overviewMonthlyConf" style="font-size:12px; color:var(--text-secondary);">Confidence: {{ monthly_confidence|floatformat:0 }}%</div>
            <div class="card-icon">üìÖ</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Revenue Trend section removed per user request -->
    <div class="card" style="padding:18px; border-radius:10px; background:#fff; border:1px solid var(--border); margin-bottom:28px; text-align:center; color:var(--text-secondary);">
      <p style="margin:0;">Revenue Trend section removed.</p>
    </div>

<!-- forecast-hero-grid: moved earlier in the file to match requested design -->
    <script>
      function updateLiveUI(){
        const ind = document.getElementById('liveIndicator');
        const btn = document.getElementById('btnLiveToggle');
        const sel = document.getElementById('liveIntervalSelect');
        if(window._live.enabled){
          ind.classList.remove('live-indicator-off'); ind.classList.add('live-indicator-on'); ind.style.background = '#10b981'; btn.setAttribute('aria-pressed','true');
          sel.disabled = false;
        } else {
          ind.classList.remove('live-indicator-on'); ind.classList.add('live-indicator-off'); ind.style.background = '#d1d5db'; btn.setAttribute('aria-pressed','false');
          sel.disabled = false;
        }
      }
      function startLive(){
        try{
          stopLive();
          window._live.intervalSec = parseInt(document.getElementById('liveIntervalSelect').value || '60', 10);
          window._live.enabled = true;
          // do an immediate refresh then schedule
          refreshForecast();
          window._live.timerId = setInterval(function(){ if(!window._live.paused) refreshForecast(); }, Math.max(1000, window._live.intervalSec * 1000));
          updateLiveUI();
        }catch(e){ console.warn('startLive failed', e); }
      }
      function stopLive(){
        window._live.enabled = false;
        if(window._live.timerId){ try{ clearInterval(window._live.timerId); }catch(e){} window._live.timerId = null; }
        updateLiveUI();
      }
      document.getElementById('btnLiveToggle')?.addEventListener('click', function(){ if(window._live.enabled) stopLive(); else startLive(); });
      document.getElementById('liveIntervalSelect')?.addEventListener('change', function(){ if(window._live.enabled){ startLive(); } });

      // Pause polling when tab is hidden to reduce noise
      document.addEventListener('visibilitychange', function(){ if(document.hidden){ window._live.paused = true; } else { window._live.paused = false; if(window._live.enabled){ refreshForecast(); } } });

      // Stop polling when unloading
      window.addEventListener('beforeunload', function(){ stopLive(); });

      // Auto-refresh after load
      window.addEventListener('load', function(){ setTimeout(function(){ refreshForecast(); }, 600); });

      // Debug toggle removed in simplified UI
    </script>

<!-- forecast-hero-grid: moved earlier in the file to match requested design -->

    <!-- Analytics Cards removed per user request -->
    <!-- (Next Week Sales / Forecast Accuracy / Peak Day cards removed) -->

    <!-- Simplified layout: diagnostics and debug panel removed for cleaner UI -->

    <!-- Product forecasts removed per request -->

    <style>
      /* Local styles to improve layout, spacing and visual hierarchy */
      .muted { color: var(--text-secondary); }
      .small-text { font-size: 13px; }
      .page-header { margin-bottom: 36px; }
      .filters-card { background: #fff; border: 1px solid var(--border); padding: 14px 16px; border-radius: 10px; margin-bottom: 18px; box-shadow: var(--shadow-sm); }
      .filters-row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
      .filters-group { display:flex; gap:8px; align-items:center; }
      .filter-label { font-weight:700; font-size:13px; color:var(--text-secondary); }
      .filter-input { padding:8px; border:1px solid var(--border); border-radius:6px; min-width:160px; }
      .filters-actions { margin-left:auto; display:flex; gap:8px; align-items:center; }

      .btn { padding:8px 12px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); background:#fff; font-weight:700; cursor:pointer; }
      .btn-ghost { background:transparent; border:1px solid var(--border); }
      .btn-primary { background:var(--accent); color:#fff; border-color:var(--accent); }
      .btn .btn-icon { margin-right:6px; }
      .btn.loading { opacity:0.8; pointer-events:none; }

      /* Dark theme hero tiles */
      /* Hero summary row (simplified to match mock) */
      .hero-row { display:flex; gap:16px; align-items:stretch; margin-bottom:18px; }
      .hero-card { flex:1; background:#fff; border-radius:12px; padding:18px 20px; box-shadow:var(--shadow-sm); border:1px solid var(--border); }
      .hero-card-label { font-size:13px; color:var(--text-secondary); font-weight:700; }
      .forecast-hero-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:20px; align-items:stretch; margin-bottom:28px; }
      .forecast-hero-card{ background:#fff; border-radius:12px; padding:18px 20px; box-shadow:0 8px 24px rgba(16,24,40,0.04); border:1px solid rgba(16,24,40,0.04); min-height:126px; position:relative; }
      .forecast-hero-card .hero-pct{ position:absolute; top:14px; right:14px; font-size:12px; }
      .forecast-hero-card .hero-icon{ width:44px; height:44px; border-radius:10px; background:rgba(15,23,36,0.03); display:flex; align-items:center; justify-content:center; }
      .forecast-hero-card .hero-title{ font-size:14px; font-weight:700; color:var(--fg); }
      .forecast-hero-card .hero-date{ font-size:12px; color:var(--text-secondary); margin-top:4px; }
      .forecast-hero-card .hero-amount{ font-size:38px; font-weight:900; margin-top:12px; color:#111; }
      .forecast-hero-card .hero-row-bottom{ display:flex; justify-content:space-between; align-items:center; margin-top:12px; font-size:13px; color:var(--text-secondary); }

      .overview-grid { display:flex !important; gap:16px; margin-bottom:18px; align-items:stretch; overflow-x:auto; -webkit-overflow-scrolling:touch; padding-bottom:6px; justify-content:space-between; flex-wrap:wrap; position:relative; }
      .overview-grid .overview-card { flex: 1 1 calc(33.333% - 16px); min-width:260px; max-width:calc(33.333% - 16px); background:#fff; border-radius:10px; padding:20px 24px; box-shadow:var(--shadow-sm); border:1px solid rgba(0,0,0,0.18); min-height:110px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
      .overview-grid .overview-card .card-left { flex:1 1 auto; }
      .overview-grid .overview-card .card-right { display:flex; align-items:center; gap:8px; margin-left:12px; }
      .overview-grid .overview-card .card-icon { width:44px; height:44px; border-radius:8px; background:rgba(15,23,36,0.03); display:flex; align-items:center; justify-content:center; }
      /* Responsive breakpoints: 3-up -> 2-up -> 1-up */
      @media (max-width: 980px) { .overview-grid .overview-card { flex: 1 1 calc(50% - 12px); max-width: calc(50% - 12px); } }
      @media (max-width: 680px) { .overview-grid { gap: 12px; } .overview-grid .overview-card { flex:1 1 100%; max-width:100%; } }

      /* When the sidebar overlays or is expanded, keep cards on one horizontal row that can be scrolled into view */
      .page-wrapper.sidebar-expanded .overview-grid,
      .sidebar:hover + .main-content .overview-grid,
      .sidebar:hover ~ .main-content .overview-grid {
        flex-wrap: nowrap !important;
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch;
      }
      .page-wrapper.sidebar-expanded .overview-grid .overview-card { flex: 0 0 320px !important; min-width:320px !important; max-width:320px !important; }
      .page-wrapper.sidebar-expanded .overview-grid::after { content: ''; position: absolute; right: 0; top: 0; width: 48px; height: 100%; pointer-events: none; background: linear-gradient(to left, rgba(255,255,255,0.95), rgba(255,255,255,0)); }

      /* Shift the inner content container to the right when the sidebar expands or is hovered so cards are not hidden */
      .page-wrapper.sidebar-expanded .main-content .container,
      .sidebar:hover + .main-content .container,
      .sidebar:hover ~ .main-content .container {
        margin-left: 208px !important;
        transition: margin-left 220ms ease;
      }
      /* If viewport is very small, use a smaller shift so content stays readable */
      @media (max-width: 900px) {
        .page-wrapper.sidebar-expanded .main-content .container,
        .sidebar:hover + .main-content .container,
        .sidebar:hover ~ .main-content .container { margin-left: 140px !important; }
      }
      .badge { padding:6px 10px; border-radius:8px; font-weight:700; font-size:12px; }
      .badge-warning { background:#fef3c7; color:#92400e; }
      .badge-danger { background:#fff3f2; color:#7f1d1d; }

      /* Analytics cards removed as per design request */

      /* Chart card: simplified, subtle border and shadow to match mock */
      .card.chart-card { background: #fff; border:1px solid rgba(15,23,36,0.06); border-radius:12px; padding:20px 24px; box-shadow:0 8px 30px rgba(16,24,40,0.06); margin-bottom:32px; overflow:hidden; }
      .card.chart-card .chart-area { position:relative; height:460px; border-radius:12px; background:#fff; padding:12px; }

      /* Slight header tweak */
      .section-title { font-size:22px; margin-bottom:6px; font-weight:800; }

      /* Improve forecast wrapper spacing on wider screens */
      .forecast-wrapper { max-width: 1180px; margin: 20px auto; padding: 0 22px; padding-left:36px; box-sizing: border-box; }
      .page-wrapper.sidebar-expanded .main-content .forecast-wrapper,
      .sidebar:hover + .main-content .forecast-wrapper,
      .sidebar:hover ~ .main-content .forecast-wrapper { margin-left: auto !important; margin-right: auto !important; padding-left:36px !important; }

      /* Duplicate chart-card styles consolidated above (intentionally kept minimal to avoid overrides) */
      /* Two column layout for actual / forecast */
      .two-up{ display:grid; grid-template-columns: 1fr 1fr; gap:18px; margin-top:12px; }
      .small-card{ padding:14px; min-height:180px; }
      .small-chart-area{ height:160px; }
      @media (max-width:720px){ .two-up{ grid-template-columns: 1fr; } .small-chart-area{ height:200px; } }
      .card.chart-card canvas{ display:block; width:100% !important; height:100% !important; }

      .card.chart-card h2{ font-size:18px; margin-bottom:8px; }
      .forecast-header-mini { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
      .btn-group .btn { border-radius:8px; }
      .btn-ghost.btn-active{ background:var(--accent); color:#000; box-shadow:0 6px 18px rgba(16,24,40,0.06); }
      .btn{ transition: all .12s ease-in-out; }

      /* Move legend to top-left and make it lighter */
      .legend-row { display:flex; justify-content:flex-start; gap:18px; flex-wrap:wrap; padding:8px 0 18px 0; border-top:0; margin-top:8px; }
      .legend-item { display:flex; align-items:center; gap:8px; font-size:13px; color:var(--text-secondary); }
      .legend-swatch { width:16px; height:16px; border-radius:4px; box-shadow: 0 1px 0 rgba(0,0,0,0.04); }
      .legend-swatch.actual { background:#f97316; }
      .legend-swatch.predicted { background:#f59e0b; border:none; }
      .legend-swatch.bound { background:#fecaca; opacity:0.9; border-radius:2px; }

      /* Empty chart notice improvements */
      .empty-notice{ position:absolute; top:48%; left:50%; transform:translate(-50%,-50%); background:rgba(255,255,255,0.95); padding:14px 18px; border-radius:8px; box-shadow:0 8px 24px rgba(16,24,40,0.06); color:var(--text-secondary); }

      /* Friendly error banner shown in the chart header when API errors occur */
      .forecast-error{ background: linear-gradient(90deg, rgba(253,224,71,0.12), rgba(255,255,255,0.02)); border:1px solid rgba(250,204,21,0.12); padding:10px 12px; border-radius:8px; color:var(--text-secondary); margin-top:8px; }
      .debug-panel{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', 'Courier New', monospace; font-size:12px; }

      /* Hero tweaks */
      .forecast-hero-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:20px; align-items:stretch; margin-bottom:28px; }
      .forecast-hero-card{ background:#fff; border-radius:12px; padding:18px 20px; box-shadow:0 8px 24px rgba(16,24,40,0.04); border:1px solid rgba(16,24,40,0.04); min-height:126px; position:relative; }
      .forecast-hero-card .hero-pct{ position:absolute; top:14px; right:14px; font-size:12px; }
      .forecast-hero-card .hero-icon{ width:44px; height:44px; border-radius:10px; background:rgba(15,23,36,0.03); display:flex; align-items:center; justify-content:center; }
      .forecast-hero-card .hero-title{ font-size:14px; font-weight:700; color:var(--fg); }
      .forecast-hero-card .hero-date{ font-size:12px; color:var(--text-secondary); margin-top:4px; }
      .forecast-hero-card .hero-amount{ font-size:38px; font-weight:900; margin-top:12px; color:#111; }
      .forecast-hero-card .hero-row-bottom{ display:flex; justify-content:space-between; align-items:center; margin-top:12px; font-size:13px; color:var(--text-secondary); }

      /* Centered page wrapper for forecast page */
      .forecast-wrapper { max-width: 1100px; margin: 18px auto; padding: 0 20px; padding-left:36px; box-sizing: border-box; }
      /* Ensure the forecast wrapper stays centered even if the sidebar is hovered/expanded */
      .page-wrapper.sidebar-expanded .main-content .forecast-wrapper,
      .sidebar:hover + .main-content .forecast-wrapper,
      .sidebar:hover ~ .main-content .forecast-wrapper { margin-left: auto !important; margin-right: auto !important; padding-left:36px !important; }
      @media (max-width: 1100px) { .forecast-wrapper { max-width: 98%; padding: 0 12px; padding-left:12px; } }

      /* Responsive tweak: reduce x-label density for small screens */
      @media (max-width: 520px) { .filters-row { flex-direction: column; align-items: stretch; } .filters-actions{ margin-left:0; justify-content:flex-end; }
        .overview-grid { flex-direction: column; }
        .card.chart-card { padding:16px; }
        .legend-row { justify-content:center; }
      }

      /* Product forecast grid and pagination removed */

      /* Removed product grid responsive rules */
      .conf-badge{ padding:6px 10px; border-radius:8px; font-weight:700; font-size:12px; display:inline-block; }
      .conf-high{ background:#dcfce7; color:#065f46; }
      .conf-medium{ background:#fffbeb; color:#92400e; }
      .conf-low{ background:#fee2e2; color:#991b1b; }

      /* Growth badges for hero tiles */
      .growth-badge{ display:inline-block; padding:6px 10px; border-radius:999px; font-weight:800; font-size:12px; box-shadow: 0 2px 8px rgba(16,24,40,0.04); }
      .growth-up{ background:#ecfdf5; color:#065f46; }
      .growth-down{ background:#fff1f2; color:#991b1b; }
      .forecast-hero-card .hero-pct{ text-align:right; font-size:12px; }
      .forecast-hero-card .hero-icon svg{ opacity:0.85; }

      /* Live polling control */
      .live-controls .btn { padding:6px 8px; border-radius:10px; }
      .live-indicator-on{ background:#10b981 !important; box-shadow:0 4px 14px rgba(16,185,129,0.12); }
      .live-indicator-off{ background:#d1d5db !important; }
      .live-controls select.btn{ padding:6px 8px; border-radius:8px; }

      /* Responsive tweaks */
      @media (max-width: 520px) { .filters-row { flex-direction: column; align-items: stretch; } .filters-actions{ margin-left:0; justify-content:flex-end; }
        .overview-grid { flex-direction: column; }
      }
    </style>
  {% else %}
    <div class="card" style="text-align: center; padding: 48px 24px;">
      <p style="color: var(--text-secondary); font-size: 16px;">Loading forecast data from historical sales...</p>
      <p style="color: var(--text-secondary); font-size: 14px; margin-top: 12px;">Using real pizza sales data for ML predictions.</p>
    </div>
  {% endif %}
  </div> {# .forecast-wrapper #}
{% endblock %}
